{% extends "layouts/authenticated_content.html" %}
{% load static %}

{% block page_title %}{{ password.title }} - Details{% endblock %}

{% block authenticated_content %}
<div class="max-w-4xl mx-auto" x-data="passwordDetail()">
    <!-- Header -->
    <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-4 mb-6">
        <div class="flex items-start gap-4">
            <div class="flex h-16 w-16 items-center justify-center rounded-2xl bg-primary/10 text-primary">
                {% if password.icon %}
                    <img src="{{ password.icon.url }}" alt="" class="h-10 w-10">
                {% else %}
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-8 w-8"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                {% endif %}
            </div>
            <div>
                <h1 class="text-3xl font-bold tracking-tight text-foreground">{{ password.title }}</h1>
                <p class="text-lg text-muted-foreground">{{ password.username|default:"No username" }}</p>
                <div class="flex flex-wrap gap-2 mt-2">
                     {% if password.group %}
                        <span class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80">
                            {{ password.group.name }}
                        </span>
                    {% endif %}
                    {% if password.is_favorite %}
                        <span class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 bg-yellow-100 text-yellow-800 border-yellow-200">
                             Favorite
                        </span>
                    {% endif %}
                     {% for tag in password.tags %}
                         <span class="inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 border-transparent bg-muted text-muted-foreground hover:bg-muted/80">
                            {{ tag }}
                        </span>
                    {% endfor %}
                </div>
            </div>
        </div>
        <div class="flex gap-2">
            <a href="{% url 'passwords:edit' password.pk %}" class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-9 px-4 py-2">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 h-4 w-4"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>
                Edit
            </a>
            <button @click="deletePassword()" class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-destructive hover:text-destructive-foreground h-9 px-4 py-2 text-destructive border-destructive/50">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 h-4 w-4"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
                Delete
            </button>
        </div>
    </div>

    <!-- Main Content Grid -->
    <div class="grid gap-6 md:grid-cols-3">
        <!-- Credentials Card -->
        <div class="md:col-span-2 space-y-6">
            <div class="rounded-lg border bg-card text-card-foreground shadow-sm">
            <!-- ... content omitted for brevity... -->
            </div>
            
            <!-- ... -->
        </div>
    </div>
</div>

<script>
    function passwordDetail() {
        return {
            async copyPassword() {
                try {
                    const response = await fetch('{% url "passwords:ajax_reveal" password.pk %}');
                    const data = await response.json();
                    await navigator.clipboard.writeText(data.password);
                    showToast('Password copied to clipboard!', 'success');
                } catch (error) {
                    showToast('Failed to copy password', 'error');
                }
            },
            async copyToClipboard(text) {
                try {
                    await navigator.clipboard.writeText(text);
                    showToast('Copied to clipboard!', 'success');
                } catch (error) {
                    showToast('Failed to copy', 'error');
                }
            },
            deletePassword() {
                if (confirm('Are you sure you want to delete this password? This action cannot be undone.')) {
                    // Send delete request
                     const form = document.createElement('form');
                     form.method = 'POST';
                     form.action = '{% url "passwords:delete" password.pk %}';
                     
                     const csrfInput = document.createElement('input');
                     csrfInput.type = 'hidden';
                     csrfInput.name = 'csrfmiddlewaretoken';
                     csrfInput.value = '{{ csrf_token }}';
                     form.appendChild(csrfInput);

                     document.body.appendChild(form);
                     form.submit();
                }
            }
        }
    }
</script>
{% endblock %}