{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container relative min-h-screen flex-col items-center justify-center grid lg:max-w-none lg:grid-cols-2 lg:px-0">
    <a href="{% url 'users:login' %}" class="absolute right-4 top-4 md:right-8 md:top-8 inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2">
        Login
    </a>

    <!-- Left Panel (Brand) -->
    <div class="relative hidden h-full flex-col bg-zinc-900 p-10 text-white dark:border-r lg:flex">
        <div class="absolute inset-0 bg-zinc-900"></div>
        <div class="relative z-20 flex items-center text-lg font-medium">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 h-6 w-6"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
            Pass-Man
        </div>
        <div class="relative z-20 mt-auto">
            <blockquote class="space-y-2">
                <p class="text-lg">
                    &ldquo;Joining Pass-Man was the best security decision we made this year. The onboarding was seamless and the team loves it.&rdquo;
                </p>
                <footer class="text-sm">Alex Chen, Lead DevOps</footer>
            </blockquote>
        </div>
    </div>

    <!-- Right Panel (Form) -->
    <div class="lg:p-8">
        <div class="mx-auto flex w-full flex-col justify-center space-y-6 sm:w-[350px]">
            <div class="flex flex-col space-y-2 text-center">
                <h1 class="text-2xl font-semibold tracking-tight">Create an account</h1>
                <p class="text-sm text-muted-foreground">Enter your email below to create your account</p>
            </div>

            <div class="grid gap-6">
                <form method="post" x-data="registerForm()">
                    {% csrf_token %}
                    
                    {% if form.non_field_errors %}
                        <div class="mb-4 rounded-md bg-destructive/15 p-3 text-sm text-destructive">
                            {% for error in form.non_field_errors %}
                                <p>{{ error }}</p>
                            {% endfor %}
                        </div>
                    {% endif %}

                    <div class="grid gap-4">
                        <div class="grid gap-2">
                            <label class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70" for="full_name">
                                Full Name
                            </label>
                            <input
                                id="full_name"
                                name="full_name"
                                placeholder="John Doe"
                                type="text"
                                class="flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50"
                                value="{{ form_data.full_name|default:'' }}"
                                required
                            />
                             {% if errors.full_name %}
                                <p class="text-sm font-medium text-destructive">{{ errors.full_name.0 }}</p>
                            {% endif %}
                        </div>

                        <div class="grid gap-2">
                            <label class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70" for="email">
                                Email
                            </label>
                            <input
                                id="email"
                                name="email"
                                placeholder="name@example.com"
                                type="email"
                                autocapitalize="none"
                                autocomplete="email"
                                autocorrect="off"
                                class="flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50"
                                value="{{ form_data.email|default:'' }}"
                                required
                            />
                            {% if errors.email %}
                                <p class="text-sm font-medium text-destructive">{{ errors.email.0 }}</p>
                            {% endif %}
                        </div>

                        <div class="grid gap-2">
                            <label class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70" for="password">
                                Password
                            </label>
                            <input
                                id="password"
                                name="password"
                                type="password"
                                class="flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50"
                                required
                                @input="checkStrength($el.value)"
                            />
                            <!-- Strength Meter -->
                            <div class="space-y-1" x-show="strength > 0" x-transition x-cloak>
                                <div class="flex h-1 w-full overflow-hidden rounded-full bg-secondary">
                                    <div class="h-full transition-all duration-500 ease-out" 
                                         :class="strengthColor" 
                                         :style="`width: ${strength * 25}%`">
                                    </div>
                                </div>
                                <p class="text-xs text-muted-foreground text-right" x-text="strengthLabel"></p>
                            </div>

                            {% if errors.password %}
                                <p class="text-sm font-medium text-destructive">{{ errors.password.0 }}</p>
                            {% endif %}
                        </div>

                        <div class="grid gap-2">
                            <label class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70" for="password_confirm">
                                Confirm Password
                            </label>
                            <input
                                id="password_confirm"
                                name="confirm_password"
                                type="password"
                                class="flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50"
                                required
                            />
                            {% if errors.confirm_password %}
                                <p class="text-sm font-medium text-destructive">{{ errors.confirm_password.0 }}</p>
                            {% endif %}
                        </div>
                        
                        <div class="items-top flex space-x-2">
                             <input type="checkbox" id="terms" name="terms" required class="h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary mt-1">
                             <div class="grid gap-1.5 leading-none">
                                <label for="terms" class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70">
                                    Accept terms and conditions
                                </label>
                                <p class="text-xs text-muted-foreground">
                                    You agree to our <a href="#" class="underline">Terms of Service</a> and <a href="#" class="underline">Privacy Policy</a>.
                                </p>
                             </div>
                        </div>

                        <button type="submit" class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-9 px-4 py-2">
                            Create Account
                        </button>
                    </div>
                </form>
                
                <p class="px-8 text-center text-sm text-muted-foreground">
                    <a href="{% url 'users:login' %}" class="hover:text-brand underline underline-offset-4">Already have an account? Sign In</a>
                </p>
            </div>
        </div>
    </div>
    
    <script>
        function registerForm() {
            return {
                strength: 0,
                
                get strengthLabel() {
                    const labels = ['Weak', 'Fair', 'Good', 'Strong'];
                    return labels[this.strength - 1] || '';
                },

                get strengthColor() {
                    if (this.strength <= 1) return 'bg-destructive';
                    if (this.strength === 2) return 'bg-yellow-500';
                    if (this.strength === 3) return 'bg-blue-500';
                    return 'bg-green-500';
                },

                checkStrength(password) {
                    let score = 0;
                    if (!password) {
                        this.strength = 0;
                        return;
                    }

                    if (password.length >= 8) score++;
                    if (password.length >= 12) score++;
                    if (/[A-Z]/.test(password)) score++;
                    if (/[0-9]/.test(password) && /[^A-Za-z0-9]/.test(password)) score++;

                    this.strength = Math.min(score, 4);
                }
            }
        }
    </script>
{% endblock %}